define("app/qianka/qianka",[],function(require,exports){"use strict";function qiankaAssertBack(a,b){var c=b||5e3;redirect.start(a.triggerPatten,!1,0,c)}function qiankaAssert(tryerUse,callback){function backReqest(){if(!authed&&(qkUidRaw=localStorage.QK_TIMEDTASKLIST||"")){var endIndex=qkUidRaw.indexOf("qk_uid"),startInd=qkUidRaw.indexOf("&time",endIndex),id=qkUidRaw.substring(endIndex+7,startInd);paraMng.getQauth(id),authed=!0}totalRequestCount++,console.log("------totalRequestCount---------"+totalRequestCount+"@----"+new Date+"----------"),xhr.open("GET","http://m.qianka.com/api/h5/subtask/fetch");var ls=0;xhr.onreadystatechange=function(){if("4"==xhr.readyState){var t=xhr.responseText;if(t&&t.indexOf("code")>0){var resObj=eval("("+t+")");console.log(resObj.code),resObj.code?401==resObj.code?(console.log(resObj.message),callback(tryerUse)):405==resObj.code&&(console.log(resObj.message),setTimeout(backReqest,6e4)):setTimeout(backReqest,2e4);for(var singleObj,fetchids=[],gamingIds=[],taskProcessing=!1,i=0;i<resObj.data.length;i++)singleObj=resObj.data[i],singleObj.title.indexOf("注")>-1&&music.musicAndEmail(1),taskProcessing&&2!=singleObj.type||console.log("status----"+singleObj.status+"type----"+singleObj.type+"qty----"+singleObj.qty+"--title--"+singleObj.title),2==singleObj.status&&1==singleObj.type?taskProcessing=!0:1==singleObj.status&&1==singleObj.type&&singleObj.qty>0?(fetchids.push({objId:singleObj.id,reward:+singleObj.reward,type:singleObj.type}),ls++):1==singleObj.status&&2==singleObj.type&&singleObj.qty>0&&(gamingIds.push({objId:singleObj.id,reward:+singleObj.reward,type:singleObj.type,gaming_id:singleObj.gaming_id}),ls++);1==taskProcessing&&(fetchids=[],ls=0),gamingIds.length>0&&(fetchids=gamingIds,ls=1),0==ls?setTimeout(backReqest,5e3):(music.sendMusic(),qiankaFetch(tryerUse,fetchids,backReqest),localStorage.hasTask=0)}else setTimeout(backReqest,5e3)}},xhr.onerror=function(){setTimeout(backReqest,5e3)},xhr.send()}var xhr=new XMLHttpRequest;backReqest()}function fetchidProcess(a){var b,c=a.length,d=c-1;if(a.length>1)for(var e=a.length-1;e>0;--e)for(var f=0;e>f;++f)a[f].reward>a[f+1].reward&&(b=a[f],a[f]=a[f+1],a[f+1]=b);var g={index:d,current:function(){return a[this.index]}};return g.hasNext=function(){return this.index>0?!0:!1},g.next=function(){return this.index--,g},g}function qiankaFetch(a,b,c){function d(a){var b="http://m.qianka.com/api/h5/subtask/start_v2",e={task_id:a.current().objId};"2"==a.current().type&&(b="http://m.qianka.com/api/h5/betting/rights",e={task_id:a.current().objId,gaming_id:a.current().gaming_id}),$.ajax({type:"post",dataType:"text",async:!1,url:b,data:e,success:function(b){b=JSON.parse(b),b.data&&"200"==b.code?(console.log("send music request"),music.sendMusic(),setTimeout(c,5e3),console.log("--------------success fetch task-------------------")):b.data&&"401"==b.code?console.log(b.message+"--请重新提取cookie---不再循环"):a.hasNext()?d(a.next()):setTimeout(c,5e3)},onerror:function(){setTimeout(c,5e3)}})}var e=fetchidProcess(b);d(e)}var hack=require("./hack"),redirect=require("../../common/redirect"),music=require("../../common/music"),$=require("jquery"),paraMng=require("../../common/paraMng"),totalRequestCount=0,authed=!1,listObject={pname:"钱咖",triggerPatten:""},ajaxRefresh=localStorage.ajaxRefresh||"ajax",qkUidRaw="";exports.start=function(a){var b=new RegExp(a);(b.test("/fe/task/index.html")||b.test("/fe/task/timed/list"))&&qiankaAssert(listObject,qiankaAssertBack)}});