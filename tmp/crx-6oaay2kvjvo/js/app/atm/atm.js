define("app/atm/atm",[],function(a,b){"use strict";function c(a){var b,c=a.length,d=c-1;if(a.length>1)for(var e=a.length-1;e>0;--e)for(var f=0;e>f;++f)a[f].number>a[f+1].number&&(b=a[f],a[f]=a[f+1],a[f+1]=b);var g={index:d,current:function(){return a[this.index]}};return g.hasNext=function(){return this.index>0?!0:!1},g.next=function(){return this.index--,g},g}function d(a){var b=a.href_params+"&user="+m;i.ajax({method:"GET",url:"/trial/task/download/?"+b,beforeSend:function(a){a.setRequestHeader("Authorization","Token "+l)},success:function(){console.log("copy key word is done"),setTimeout(f,2e3)},error:function(){setTimeout(f,2e3)}})}function e(a){function b(a){var b={user:m,ad_id:a.ad_id,ad_name:a.name,ad_icon:a.icon,price:a.number},c=new FormData;for(var e in b)c.append(e,b[e]);i.ajax({url:"http://api.91atm.com/trial/task/",method:"POST",data:c,beforeSend:function(a){a.setRequestHeader("Authorization","Token "+l)},contentType:!1,processData:!1,success:function(){g.sendMusic(),d(a)},error:function(){setTimeout(f,2e3)}})}var e=c(a);b(e.current())}function f(){if(!j&&i(".alert-wrap").length>0&&(i(".alert-wrap").css({display:"none"}),j=!0),!k)return void console.log("cookie 配置失败");var a=JSON.parse(k),b=new FormData;for(var c in a)b.append(c,a[c]);i.ajax({url:"http://api.91atm.com/trial/",method:"POST",contentType:!1,processData:!1,beforeSend:function(a){a.setRequestHeader("Authorization","Token "+l)},data:b,success:function(a){console.log(a);var b=[];if(a.offers.length>0)for(var c=a.offers,d=!1,g=0;g<c.length;g++)console.log("------任务名称:"+c[g].name+"----------任务数量:"+c[g].remain),c[g].ongoing&&(d=!0),c[g].remain&&!c[g].ongoing&&b.push(c[g]);d&&(b=[]),b.length>0?e(b):setTimeout(f,2e3)},error:function(){setTimeout(f,2e3)}})}var g=a("../../common/music"),h=a("../../common/paraMng"),i=a("jquery"),j=!1;h.getPostData(),localStorage.installed="1";var k=localStorage.postData;localStorage["91atm"]=k;var l=localStorage.token,m=localStorage.user;h.getAtmAuth(l),b.start=function(){f()}});