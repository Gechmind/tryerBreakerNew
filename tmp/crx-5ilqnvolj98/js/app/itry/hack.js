define("app/itry/hack",[],function(require,exports){"use strict";function getwxurl(a){return/micromessenger/i.test(navigator.userAgent)?a+(a.indexOf("?")>0?"&":"?")+"&micromessage=true":location.origin+a}function getDetailPage(detail_url){$.ajax({type:"get",url:detail_url+"?ds=r0",dataType:"text",async:!1,success:function(backPage){var startIndext;if(backPage&&backPage.length>0&&(startIndext=backPage.indexOf("function download_app"),startIndext>0)){var miniString=backPage.substring(startIndext);startIndext=miniString.indexOf("{appid:");var endIndex=miniString.indexOf("},",startIndext),tempString=miniString.substring(startIndext,endIndex+1),tempobj=eval("("+tempString+")");exports.h_download_app(tempobj.appid,tempobj.user_id,tempobj.order_Id)}listHandleProcess.count<=1?setTimeout(dRefresh,2e3):listHandleProcess.setCount(listHandleProcess.count-1)},error:function(a,b,c){console.log(b),listHandleProcess.count<=1?setTimeout(dRefresh,2e3):listHandleProcess.setCount(listHandleProcess.count-1)}})}var $=require("jquery"),paraMng=require("../../common/paraMng"),music=require("../../common/music"),totalRequestCount=0,hasTask=!1,multiTask="0",authed=!1;"1"==localStorage.multiTask&&(multiTask="1");var listHandleProcess={count:0,length:0};listHandleProcess.setCount=function(a){this.count=a},listHandleProcess.setLength=function(a){this.length=a};var getAppDetail={},dRefresh=function(){exports.getApp(getAppDetail.user_id,getAppDetail.oid_md5)};exports.h_download_app=function(a,b,c){$.ajax({type:"post",url:"/shike/copy_keyword",data:{appid:a,user_id:b,order_Id:c},dataType:"text",async:!1,success:function(a){if("-1"==a)$(".prompt_play").html("<p>哎呀~已经被抢光了!等等看吧</p>"),$(".msg_played").show();else if(/micromessenger/i.test(navigator.userAgent))return $(".safari_top").show(),$(".Keyword_name").css({position:"absolute"}),$(".Keyword_name").css("height","0px"),$(".Keyword_name").css("width","0px"),$(".Keyword_name").css("top","-100px"),void $(".Keyword_name").css("left","-100px")}})},exports.hack_btnStatus=function(a,b,c,d,e){return 0>=e?void(listHandleProcess.count<=1?setTimeout(dRefresh,2e3):listHandleProcess.setCount(listHandleProcess.count-1)):void $.ajax({type:"post",url:"/shike/user_click_record",data:{appid:c,user_id:a,order_Id:b,type:"app"},dataType:"text",async:!1,success:function(a){"-1"==a?1==listHandleProcess.count?setTimeout(dRefresh,2e3):listHandleProcess.setCount(listHandleProcess.count-1):(console.log("抢到任务"),music.sendMusic(),getDetailPage(d))},error:function(a,b,c){console.log(b),listHandleProcess.count<=1?setTimeout(dRefresh,2e3):listHandleProcess.setCount(listHandleProcess.count-1)}})},exports.getApp=function(a,b){function c(){authed||(paraMng.authIt(a),authed=!0),$.ajax({type:"post",url:"/shike/getApplist/"+a+"/"+b,data:{r:+new Date},async:!1,success:function(a){console.log(a),hasTask=!1;var b=[];if(null!=a&&a.length>0&&"object"==typeof a)for(var e=0;e<a.length;e++)if(0!=a[e].status&&-9!=a[e].status)b.push(a[e]);else if("0"==multiTask){hasTask=!0;break}hasTask&&(b=[]),b.length>0?d(b):setTimeout(c,2e3)},error:function(){listHandleProcess.count<=1?setTimeout(dRefresh,2e3):listHandleProcess.setCount(listHandleProcess.count-1)}}),totalRequestCount++,console.log("-----------count----------"+totalRequestCount+"-------time@----------"+new Date)}function d(a){listHandleProcess.setLength(a.length),listHandleProcess.setCount(a.length),$.each(a,function(a,b){console.log("任务名称："+b.search_word+"-------任务数："+b.order_status_disp);var c=getAppDetail.user_id,d=b.order_id,f=b.appid,g=b.details_url,h=b.order_status_disp;e(c,d,f,g,h)})}getAppDetail.user_id=a,getAppDetail.oid_md5=b;var e=exports.hack_btnStatus;c()}});